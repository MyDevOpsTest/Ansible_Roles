---
- name: Insall Dependency Package glibc.i686
  yum:
     name: glibc.i686
     state: installed

- name: Set JAVA_HOME
  template:
      src  : java.sh.j2
      dest : /etc/profile.d/java.sh
      
- name: Create Jmanage Install Directory
  file:
     path: /opt/Jmanage-2.0-RC1
     state: directory
    
- name: Download and Extract Jmanage Package
  unarchive:
    src: https://master.dl.sourceforge.net/project/jmanage/jmanage%202.0/jmanage%202.0-RC1/jmanage-2.0-RC1.tar.gz
    dest: /opt/Jmanage-2.0-RC1/
    remote_src: yes
    

- name: Create Jmanage Service Directory
  file:
     path: /opt/JmanageService/
     state: directory
     mode: 0777

- name: Download Jmanage as a Service Scripts
  unarchive:  
     src: http://jexcellente.googlepages.com/jmanage-service.zip
     dest: /opt/JmanageService/
     remote_src: yes

- name: Configure Jmanage as a Service
  command: cp {{ item.src }}  {{ item.dest }}
  with_items: 
     - { src: "/opt/JmanageService/jmanage", dest: "/opt/Jmanage-2.0-RC1/bin/" }
     - { src: '/opt/JmanageService/JManage.bat', dest: '/opt/Jmanage-2.0-RC1/bin/' }
     - { src: '/opt/JmanageService/InstallJManage-NT.bat', dest:  '/opt/Jmanage-2.0-RC1/bin/' }
     - { src: '/opt/JmanageService/UninstallJManage-NT.bat', dest: '/opt/Jmanage-2.0-RC1/bin/' }
     - { src: '/opt/JmanageService/wrapper.exe', dest: '/opt/Jmanage-2.0-RC1/bin/' }
     - { src: '/opt/JmanageService/wrapper', dest: '/opt/Jmanage-2.0-RC1/bin/' }
     - { src: '/opt/JmanageService/wrapper.conf', dest: '/opt/Jmanage-2.0-RC1/config/' }
     - { src: '/opt/JmanageService/libwrapper.so', dest: '/opt/Jmanage-2.0-RC1/lib/' }
     - { src: '/opt/JmanageService/wrapper.dll', dest: '/opt/Jmanage-2.0-RC1/lib/' }
     - { src: '/opt/JmanageService/wrapper.jar', dest: '/opt/Jmanage-2.0-RC1/lib/' }

- name: Make Bin files are Executable
  command: find /opt/Jmanage-2.0-RC1/bin/ -type f -name "*" -exec chmod +x {} ;
  
- name: Set Environment for Jmanage
  shell: /opt/Jmanage-2.0-RC1/bin/setenv.sh
  sudo: yes


- name: Start Jmanage
  shell: /opt/Jmanage-2.0-RC1/bin/jmanage start
  become: true 
